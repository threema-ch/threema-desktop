<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="594px" preserveAspectRatio="none" style="width:1770px;height:594px;background:#FFFFFF;" version="1.1" viewBox="0 0 1770 594" width="1770px" zoomAndPan="magnify"><defs/><g><rect fill="#ADD8E6" height="582.0156" style="stroke:#181818;stroke-width:0.5;" width="304.5" x="1433.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="104" x="1533.75" y="18.0669">Task Manager</text><rect fill="#FFFFFF" height="145.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="62.5" y="314.7891"/><rect fill="#FFFFFF" height="145.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="179.5" y="314.7891"/><rect fill="#FFFFFF" height="116.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="453" y="343.9219"/><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="728.5" y="373.0547"/><rect fill="#FFFFFF" height="58.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1078" y="402.1875"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1327.5" y="431.3203"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="67" x2="67" y1="73.4297" y2="536.7188"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="184" x2="184" y1="73.4297" y2="536.7188"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="458" x2="458" y1="73.4297" y2="536.7188"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="733.5" x2="733.5" y1="73.4297" y2="536.7188"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1082.5" x2="1082.5" y1="73.4297" y2="536.7188"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1332.5" x2="1332.5" y1="73.4297" y2="536.7188"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1498.5" x2="1498.5" y1="111.5781" y2="536.7188"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1684" x2="1684" y1="73.4297" y2="536.7188"/><path d="M23,47.1328 L112,47.1328 C117,47.1328 117,60.2813 117,60.2813 C117,60.2813 117,73.4297 112,73.4297 L23,73.4297 C18,73.4297 18,60.2813 18,60.2813 C18,60.2813 18,47.1328 23,47.1328 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M112,47.1328 C107,47.1328 107,60.2813 107,60.2813 C107,73.4297 112,73.4297 112,73.4297 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="23" y="65.1279">WebSocket</text><path d="M23,535.7188 L112,535.7188 C117,535.7188 117,548.8672 117,548.8672 C117,548.8672 117,562.0156 112,562.0156 L23,562.0156 C18,562.0156 18,548.8672 18,548.8672 C18,548.8672 18,535.7188 23,535.7188 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M112,535.7188 C107,535.7188 107,548.8672 107,548.8672 C107,562.0156 112,562.0156 112,562.0156 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="23" y="553.7139">WebSocket</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="115" x="127" y="42.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="134" y="62.1279">1: Frame Layer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="115" x="127" y="535.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="134" y="555.7139">1: Frame Layer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="132" x="392" y="42.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="399" y="62.1279">2: Multiplex Layer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="132" x="392" y="535.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="399" y="555.7139">2: Multiplex Layer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="350" x="558.5" y="42.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="336" x="565.5" y="62.1279">3: Authentication and Transport Encryption Layer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="350" x="558.5" y="535.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="336" x="565.5" y="555.7139">3: Authentication and Transport Encryption Layer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="329" x="918.5" y="42.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="315" x="925.5" y="62.1279">4: Connection Monitoring and Keepalive Layer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="329" x="918.5" y="535.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="315" x="925.5" y="555.7139">4: Connection Monitoring and Keepalive Layer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="150" x="1257.5" y="42.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136" x="1264.5" y="62.1279">5: End-to-End Layer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="150" x="1257.5" y="535.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136" x="1264.5" y="555.7139">5: End-to-End Layer</text><path d="M1442.5,535.7188 L1554.5,535.7188 C1559.5,535.7188 1559.5,548.8672 1559.5,548.8672 C1559.5,548.8672 1559.5,562.0156 1554.5,562.0156 L1442.5,562.0156 C1437.5,562.0156 1437.5,548.8672 1437.5,548.8672 C1437.5,548.8672 1437.5,535.7188 1442.5,535.7188 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1554.5,535.7188 C1549.5,535.7188 1549.5,548.8672 1549.5,548.8672 C1549.5,562.0156 1554.5,562.0156 1554.5,562.0156 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1442.5" y="553.7139">DecodeQueue</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="1635" y="70.1279">TaskManager</text><ellipse cx="1684.5" cy="41.1328" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="1680.5,29.1328,1686.5,24.1328,1684.5,29.1328,1686.5,34.1328,1680.5,29.1328" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="1635" y="548.7139">TaskManager</text><ellipse cx="1684.5" cy="568.0156" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#181818" points="1680.5,556.0156,1686.5,551.0156,1684.5,556.0156,1686.5,561.0156,1680.5,556.0156" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#FFFFFF" height="145.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="62.5" y="314.7891"/><rect fill="#FFFFFF" height="145.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="179.5" y="314.7891"/><rect fill="#FFFFFF" height="116.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="453" y="343.9219"/><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="728.5" y="373.0547"/><rect fill="#FFFFFF" height="58.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1078" y="402.1875"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1327.5" y="431.3203"/><polygon fill="#181818" points="1570.5,100.5625,1560.5,104.5625,1570.5,108.5625,1566.5,104.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1564.5" x2="1683.5" y1="104.5625" y2="104.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="1576.5" y="99.4966">exposes</text><path d="M1442.5,83.4297 L1554.5,83.4297 C1559.5,83.4297 1559.5,96.5781 1559.5,96.5781 C1559.5,96.5781 1559.5,109.7266 1554.5,109.7266 L1442.5,109.7266 C1437.5,109.7266 1437.5,96.5781 1437.5,96.5781 C1437.5,96.5781 1437.5,83.4297 1442.5,83.4297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1554.5,83.4297 C1549.5,83.4297 1549.5,96.5781 1549.5,96.5781 C1549.5,109.7266 1554.5,109.7266 1554.5,109.7266 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1442.5" y="101.4248">DecodeQueue</text><path d="M5,124.7266 L5,149.7266 L130,149.7266 L130,134.7266 L120,124.7266 L5,124.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M120,124.7266 L120,134.7266 L130,134.7266 L120,124.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="11" y="141.7935">Mediator Socket</text><path d="M614,124.7266 L614,179.7266 L852,179.7266 L852,134.7266 L842,124.7266 L614,124.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M842,124.7266 L842,134.7266 L852,134.7266 L842,124.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="620" y="141.7935">Handle CSP and D2M handshakes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="652" y="156.9263">=&gt;authentication state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="620" y="172.0591">CSP transport encryption</text><path d="M931,124.7266 L931,149.7266 L1234,149.7266 L1234,134.7266 L1224,124.7266 L931,124.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1224,124.7266 L1224,134.7266 L1234,134.7266 L1224,124.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="937" y="141.7935">Send CSP echo requests and wait for replies</text><path d="M1611,124.7266 L1611,179.7266 L1758,179.7266 L1758,134.7266 L1748,124.7266 L1611,124.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1748,124.7266 L1748,134.7266 L1758,134.7266 L1748,124.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="1617" y="141.7935">Process message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="1617" y="156.9263">handle transactions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="1617" y="172.0591">handle queues</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1763" x="0" y="205.6914"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1763" y1="205.6914" y2="205.6914"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1763" y1="208.6914" y2="208.6914"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="89" x="837" y="195.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="70" x="843" y="211.1919">Decoding</text><path d="M73,233.2578 L73,258.2578 L296,258.2578 L296,243.2578 L286,233.2578 L73,233.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M286,233.2578 L286,243.2578 L296,243.2578 L286,233.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="79" y="250.3247">Decode bytes to d2m.container</text><path d="M306,233.2578 L306,288.2578 L610,288.2578 L610,243.2578 L600,233.2578 L306,233.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M600,233.2578 L600,243.2578 L610,243.2578 L600,233.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="312" y="250.3247">Demultiplex d2m.container to either</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="312" y="265.4575">a D2M (protobuf) message, or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="312" y="280.5903">a CSP frame (type depending on auth state)</text><path d="M620,233.2578 L620,288.2578 L847,288.2578 L847,243.2578 L837,233.2578 L620,233.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M837,233.2578 L837,243.2578 L847,243.2578 L837,233.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="626" y="250.3247">CSP transport decryption</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="626" y="265.4575">Decode post-auth CSP payloads</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="626" y="280.5903">Forward D2M messages</text><path d="M1232,233.2578 L1232,273.2578 L1433,273.2578 L1433,243.2578 L1423,233.2578 L1232,233.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1423,233.2578 L1423,243.2578 L1433,243.2578 L1423,233.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="1238" y="250.3247">Dispatch messages to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="1238" y="265.4575">TaskManager decode queue</text><polygon fill="#181818" points="167.5,310.7891,177.5,314.7891,167.5,318.7891,171.5,314.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="72.5" x2="173.5" y1="314.7891" y2="314.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="79.5" y="309.7231">ArrayBuffer</text><polygon fill="#181818" points="441,339.9219,451,343.9219,441,347.9219,445,343.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="189.5" x2="447" y1="343.9219" y2="343.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="196.5" y="338.856">InboundL1Message</text><polygon fill="#181818" points="716.5,369.0547,726.5,373.0547,716.5,377.0547,720.5,373.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="463" x2="722.5" y1="373.0547" y2="373.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="470" y="367.9888">InboundL2Message</text><polygon fill="#181818" points="1066,398.1875,1076,402.1875,1066,406.1875,1070,402.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="738.5" x2="1072" y1="402.1875" y2="402.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="745.5" y="397.1216">InboundL3Message</text><polygon fill="#181818" points="1315.5,427.3203,1325.5,431.3203,1315.5,435.3203,1319.5,431.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1088" x2="1321.5" y1="431.3203" y2="431.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1095" y="426.2544">InboundL4Message</text><polygon fill="#181818" points="1486.5,456.4531,1496.5,460.4531,1486.5,464.4531,1490.5,460.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1332.5" x2="1492.5" y1="460.4531" y2="460.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="1339.5" y="455.3872">InboundTaskMessage</text><polygon fill="#181818" points="1509.5,485.5859,1499.5,489.5859,1509.5,493.5859,1505.5,489.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1503.5" x2="1683.5" y1="489.5859" y2="489.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="1515.5" y="484.52">Fetch Message (blocking)</text><polygon fill="#181818" points="1672.5,514.7188,1682.5,518.7188,1672.5,522.7188,1676.5,518.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1498.5" x2="1678.5" y1="518.7188" y2="518.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="1505.5" y="513.6528">InboundTaskMessage</text><!--MD5=[51af069d79e7e01cefb19d65e2011571]
@startuml
queue WebSocket
participant "1: Frame Layer" as 1
participant "2: Multiplex Layer" as 2
participant "3: Authentication and Transport Encryption Layer" as 3
participant "4: Connection Monitoring and Keepalive Layer" as 4
participant "5: End-to-End Layer" as 5

box "Task Manager" #LightBlue
queue "DecodeQueue" as TaskManagerDecodeQueue
control TaskManager



create TaskManagerDecodeQueue
TaskManager -> TaskManagerDecodeQueue: exposes

end box

note over WebSocket: Mediator Socket
/ note over 3: Handle CSP and D2M handshakes\n\t=>authentication state \nCSP transport encryption
/ note over 4: Send CSP echo requests and wait for replies
/ note over TaskManager: Process message\nhandle transactions\nhandle queues

== Decoding ==

note over 1: Decode bytes to d2m.container
/ note over 2: Demultiplex d2m.container to either\na D2M (protobuf) message, or\na CSP frame (type depending on auth state)
/ note over 3: CSP transport decryption\nDecode post-auth CSP payloads\nForward D2M messages
/ note over 5: Dispatch messages to\nTaskManager decode queue


WebSocket -> 1: ArrayBuffer
activate WebSocket
activate 1
1 -> 2: InboundL1Message
activate 2
2 -> 3: InboundL2Message
activate 3
3 -> 4: InboundL3Message
activate 4
4 -> 5: InboundL4Message
activate 5
5 -> TaskManagerDecodeQueue: InboundTaskMessage

deactivate WebSocket
deactivate 1
deactivate 2
deactivate 3
deactivate 4
deactivate 5

TaskManagerDecodeQueue <- TaskManager: Fetch Message (blocking)
return InboundTaskMessage

@enduml

PlantUML version 1.2022.6(Tue Jun 21 19:34:49 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>